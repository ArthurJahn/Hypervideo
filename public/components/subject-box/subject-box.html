<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">

<link rel="import" href="../../components/hypervideo-node/hypervideo-preview.html">
<link rel="import" href="../../components/grid-container/grid-container.html">

<dom-module id="subject-box">
  <style>
    #mainPanel {
      float: left;
      width: 49%;
      margin: 0.5%;
      height: 400px;
    }
    #mainPanel paper-toolbar {
      font-size: 15px;
      line-height: 10px;
      height: 40px;
      width: 100%;
      padding: 0;
      color: #616161;
      background-color: rgba(246,246,246,1);/*var(--light-divider-color);*/
    }
    #mainPanel paper-toolbar p {
      padding: 0 20px;
    }
    #mainPanel .wrapper {
      height: 360px;
    }
    #backcanvas {
      position: absolute;
      width: 100%;
      height: 280px;
      background-color:rgba(246,246,246,1);/*var(--light-divider-color);*/
    }
    #backcanvas canvas{
      width: 100%;
      height: 100%;
    }
    #gridarea {
      position: absolute;
      width: 95%;
      height: 245px;
    }
    #hypers {
      position: absolute;
      top:15px;
    }
  </style>
  <template>
    <paper-header-panel id="mainPanel" mode="seamed">
      <paper-toolbar>
        <p>{{subject.name}}</p>
      </paper-toolbar>
      <div class="wrapper">
        <div id="backcanvas">
          <div id="gridarea"></div>
          <canvas id="canvas"></canvas>
        </div>
        <grid-container id="hypers">
        </grid-container>
      </div>
    </paper-header-panel>
  </template>
  <script>
  Polymer({
    is: 'subject-box',
    properties: {
      subject: {
        type: Object,
        value: null
      },
      hypervideos: {
        type: Array,
        value: function() {
          return [];
        },
        observer: "presentHypervideos"
      }
    },
    listeners: {
      'iron-resize': '_onIronResize'
    },
    behaviors: [
      Polymer.IronResizableBehavior
    ],
    ready: function() {

    },
    attached: function() {
      var self = this;
      self.$.hypers.bounds = self._getTouchableBounds();
      if (self.subject) {
        self.fire('get-hypervideos');
      }
    },
    presentHypervideos: function() {
      var self = this;
      if(self.hypervideos) {
        self.$.hypers.bounds = self._getTouchableBounds();
        for(var i=0; i< self.hypervideos.length; i++) {
          var hypervideo = self.hypervideos[i];
          var preview = new hypervideoPreview(hypervideo);
          self.$.hypers.appendGridChild(preview);
        }
      }
    },
    _getTouchableBounds: function() {
      var self = this;
      var rect = self.$.gridarea.getBoundingClientRect();
      var bounds = {
        width: rect.right - rect.left,
        height: rect.bottom - rect.top,
        x: rect.left,
        y: rect.top + 10
      }
      return bounds;
    },
    _onIronResize: function() {
      this.$.hypers.bounds = this._getTouchableBounds();
    },
  });
  </script>
</dom-module>
